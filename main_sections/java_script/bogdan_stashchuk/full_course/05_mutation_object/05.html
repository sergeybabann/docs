<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>05 Мутация объектов</title>
    <link rel="stylesheet" href="../../../../../css/normalize.css">
    <link rel="stylesheet" href="../../../../../css/vars.css">
    <link rel="stylesheet" href="../../../../../css/main.css">
    <link rel="stylesheet" href="../../../../../css/header.css">
    <link rel="stylesheet" href="../../../../../css/content.css">
    <link rel="stylesheet" href="../../../../../css/sidebar_1.css">
    <link rel="stylesheet" href="../../../../../css/sidebar_2.css">
    <link rel="stylesheet" href="../../../../../css/footer.css">
    <link rel="stylesheet" href="../../../../../css/templates.css">
</head>

<body>

    <div class="wrapper">
        <!----- HEADER ----->
        <div class="header general__area-1">
            <a name="HEADER"></a>
            <div class="header__space">
                <div class="header__descr">
                    <h1 class="header__h1">
                        Обучающий<br> курс
                    </h1>
                    <span class="header__descr-1">Полный курс JavaScript
                    </span>
                    <ul class="header__descr-2">
                        <li>Источник: rutracker</li>
                        <li>Автор: Богдан Сташчук</li>
                        <li>Спецификация: JavaScript</li>
                    </ul>
                </div><!--tutorial__descr-->
                <ul class="header__navmenu-list">
                    <li class="header__navmenu-item">
                        <a href="../../../../../index.html" class="header__navmenu-link">Главная страница сайта</a>
                    </li>
                    <li class="header__navmenu-item">
                        <a href="../../../javascript.html" class="header__navmenu-link">Курсы JavaScript</a>
                    </li>
                    <li class="header__navmenu-item">
                        <a href="../course.html" class="header__navmenu-link">Главная
                            страница курса</a>
                    </li>
                </ul>
            </div><!--header__space-->
        </div><!--header-->




        <!----- ASIDE-1 ----->
        <div class="aside-1 general__area-1">
            <ul class="aside-1__index-search-list">
                <li class="aside-1__index-search-item">
                    <a class="aside-1__index-search-link" href="#"></a>
                </li>
            </ul><!--aside-1__index-search-list-->
        </div><!--aside-1-->






        <!----- CONTENT ----->
        <div class="main general__area-1">
            <h2 class="main__h2">5 Мутация объектов</h2>
            <div class="main__wrapper">

                <!----- Мутация в JavaScript ----->
                <a name="MUTATION_IN_JAVASCRIPT"></a>
                <div class="main__title-1">Мутация в JavaScript</div>
                <p class="main__subtitle-1">
                    Папка 01. Значения примитивных типов
                </p>
                <p class="main__p">
                    Как же копируются значения примтивных типов.
                </p>
                <pre>
                    <code>
                        const a = 10

                        let b = a
                        
                        b = 30
                        
                        console.log(a) // 10
                        console.log(b) // 30                 
                    </code>
                </pre>
                <p class="main__p">
                    В примере выше есть переменная <span class="strong">a</span> и ее значение - это число. Далее
                    копируем значение
                    переменной <span class="strong">a</span> в переменную <span class="strong">b</span> c помощью
                    оператора присваивания (=).
                    С примитивными типами такое копирование происходит по значению, то есть берется значение, которое
                    находилось в переменной <span class="strong">a</span> и копируется в пременную <span
                        class="strong">b</span>
                    (Значения примитивных типов сохраняются непосредственно в перемнных), поэтому копирование происходит
                    по значению. После такого копирования мы допустим хотим присвоить новое значение переменной
                    <span class="strong">b</span> что и делаем вот таким образом:
                </p>
                <pre>
                    <code>
                        b = 30
                    </code>
                </pre>
                <p class="main__p">
                    А вот значение переменной <span class="strong">a</span> не изменилось, значение 10<br>
                    Потому,что мы просто скопировали значение переменной <span class="strong">a</span> в переменную
                    <span class="strong">b</span>
                </p>

                <p class="main__subtitle-1">
                    Папка 02. Значения ссылочного типа.
                </p>
                <p class="main__p">
                    Теперь посмотрим, что же произойдет, если мы скопируем объект, то есть значение ссылочного типа.
                </p>
                <pre>
                    <code>
                        const person = {
                            name: 'Bob',
                            age: 21
                        }
                        
                        person.age = 22
                        person.isAdult = true
                        
                        console.log(person.age) // 22
                        console.log(person.isAdult) // true 
                    </code>
                </pre>
                <p class="main__p">
                    У нас есть объект person , и в нем есть 2 свойста: name и age<br>
                    Но прежде чем копировать, давайте попытаемся просто изменить этот объект, используя ту
                    же переменную. Но при этом, из-за того, что объект - это ссылочный тип, мы можем менять значение
                    тех или иных свойств объекта, что и происходит вот здесь:
                </p>
                <pre>
                    <code>
                        person.age = 22
                        person.isAdult = true
                    </code>
                </pre>
                <p class="main__p">
                    Используя точечную запись, мы меняем значение свойства age , и добавляем еще одно свойство
                    isAdult со значением true<br>
                    Тем самым в объекте есть уже 3 свойства. По сути, мы мутировали объект, не смотря на то, что сама
                    переменная person была объявлена с помощью const<br>
                    Это возможно из-за того, что объект - это ссылочный тип.
                </p>

                <p class="main__subtitle-1">
                    Папка 03. Мутирование копий.
                </p>
                <p class="main__p">

                </p>
                <pre>
                    <code>
                        const person = {
                            name: 'Bob',
                            age: 25
                        }
                        
                        const person2 = person
                        
                        person2.age = 26
                        person2.isAdult = true
                        
                        console.log(person.age) // 26
                        console.log(person.isAdult) // true 
                    </code>
                </pre>
                <p class="main__p">
                    У нас есть объект person c 2-мя свойствами name и age, но теперь мы создаем еще одну переменную
                    person2 , и копируем в нее переменную person , вот так:
                </p>
                <pre>
                    <code>
                        const person2 = person
                    </code>
                </pre>
                <p class="main__p">
                    Мы помним о том, что мы копируем только ссылку, сам объект остается в другом месте памяти.
                    И вот после этого мы можем мутировать объект, используя скопированную переменную person2<br>
                    Далее мы меняем значение свойства age , и добавляем еще одно свойство isAdult , вот так:
                </p>
                <pre>
                    <code>
                        person2.age = 26
                        person2.isAdult = true
                    </code>
                </pre>
                <p class="main__p">
                    И после таких операций значения свойств age и isAdult переменной person также изменятся.
                    Это происходит потому, что эти 2 переменные person и person2 ссылаются на один и тот же объект в
                    памяти. И мы можем менять этот объект как через переменную person , так и через переменную person2
                </p>
                <p class="main__p note">
                    Это называется - Мутирование объекта через копию.
                </p>
                <p class="main__p">
                    И это происходит из-за того, что мы копируем только ссылку. И по английски это называется
                    <span class="strong">copy by reference</span>
                    С примитивными типами это называется <span class="strong">copy by value</span> (копирование по
                    значению). И об
                    этом вам всегда необходимо помнить, как разработчику JavaScript , когда вы копируете объекты.
                    Потому что, изменив копию, вы будете менять соответственно и исходный объект.
                </p>
                <p class="main__p">
                    Переменные person и person2 будут иметь одни и те же значения свойств, так как они ссылаются на один
                    и тот же объект в памяти.
                </p>






                <!----- Как избежать мутации объектов ----->
                <a name="HOW_TO_AVOID_OBJECT_MUTATION"></a>
                <div class="main__title-1">
                    Как избежать мутации объектов
                </div>
                <p class="main__p">
                    Что делать, если вы не хотите, чтобы оригинальный объект менялся, когда вы создаете копию этого
                    объекта, когда вы создаете новый объект?<br>
                    Мы рассмотрим несколько вариантов того, как можно решить такую задачу.
                </p>

                <!----- Папка 1 ----->
                <a name="HOW_TO_AVOID_OBJECT_MUTATION.1"></a>
                <p class="main__subtitle-1">
                    Папка 01. Вариант №1
                </p>
                <p class="main__p">
                    Мы здесь используем такой метод, как assign<br>
                    Этот метод является методом объекта object <br>
                    Этот объект является частью глобального объекта (это свойство глобального объекта) и потому
                    он доступен как в веб-браузерах, так и в node.js
                </p>
                <pre>
                    <code>
                        const person = {
                            name: 'Bob',
                            age: 25
                        }
                        
                        const person2  = Object.assign({}, person)
                        
                        person2.age = 26
                        
                        console.log(person2.age) // 26
                        console.log(person.age) // 25
                    </code>
                </pre>
                <p class="main__p note">
                    Обратите внимание, что название переменной Object написано с заглавной буквы. Такой формат записи
                    называется Pascal Case. Такой формат записи используется для записи Классов и Типов в JavaScript.
                    Object - это и Класс и Тип в JavaScript , и потому он написан с большой буквы. Object является
                    прототипом
                    всех объекитов в JavaScript.
                </p>
                <p class="main__p">
                    С помощью метода assign можно создавать новые объекты.
                </p>
                <pre>
                    <code>
                        const person2  = Object.assign({}, person)
                    </code>
                </pre>
                <p class="main__p">
                    С помощью такого синтаксиса - Object.assign , в круглых скабках будет фигурная скобка - это пустой
                    объект, а второй аргумент здесь - это название переменной person<br>
                    person - это наш объект, который мы хотим скопировать. По сути мы хотим создать новый оъект на
                    основании объекта person<br>
                    И вот Object.assign c синтаксисом в круглых скобках
                </p>
                <pre>
                    <code>
                        Object.assign({} person)
                    </code>
                </pre>
                <p class="main__p">
                    создаст новый объект и запишет в него все свойства объекта person<br>
                    И если мы будем менять свойство переменной person2 вот таким образом
                </p>
                <pre>
                    <code>
                        person2.age = 26
                    </code>
                </pre>
                <p class="main__p">
                    ,то это свойство age поменяется только уже в объекте person2 , потому что он является новым
                    объектом. В переменной person2 находится новая ссылка на новый объект, и эта ссылка не совпадает со
                    ссылкой переменной person<br>
                    Потому что мы создали новый объект. И их значения будут соответственно разные:
                </p>
                <pre>
                    <code>
                        console.log(person2.age) // 26
                        console.log(person.age) // 25
                    </code>
                </pre>
                <p class="main__p">
                    Мы не мутировали оригинальный объект.
                </p>
                <p class="main__p">
                    Если у объекта person будут вложенные объекты (свойства, значение которых - объекты), то
                    ссылки на эти вложенные объекты сохраняются при создании нового объекта. То есть по сути мы можем
                    избежать мутирования только корневых свойств (в данном примере name и age). В данном примере, где у
                    нас нет вложенных объектов, вы вполне можете использовать такой синтаксис создания копии объекта.
                </p>
                <pre>
                    <code>
                        Object.assign
                    </code>
                </pre>
                <p class="main__p">
                    Но если у вас в объекте person есть вложенные объекты, такой вариант не совсем подойдет, потому что
                    эти вложенные свойства, которые ссылаются на объекты не изменятся. То есть их ссылки останутся
                    неизменными в объекте оригинальном и в новом. Потому вы сможете частично мутировать оригинальный
                    объект.
                </p>
                <p class="main__p">
                    Это немного сложно, поэтому мы остановимся на том, что мы исходим из того, что у объекта person нет
                    вложенных объектов. В таком случае такой вариант создания копий подойдет:
                </p>
                <pre>
                    <code>
                        const person2  = Object.assign({}, person)
                    </code>
                </pre>
                <pre>
                    <code>
                        const person = {
                            name: 'Bob',
                            age: 25
                        }
                        
                        const person2  = Object.assign({}, person)
                        
                        person2.age = 26
                        
                        console.log(person2.age) // 26
                        console.log(person.age) // 25
                    </code>
                </pre>

                <!----- Папка 2 ----->
                <a name="HOW_TO_AVOID_OBJECT_MUTATION.2"></a>
                <p class="main__subtitle-1">
                    Папка 02. Вариант №2, который позволяет создавать копии объекта.
                </p>
                <pre>
                    <code>
                        const person = {
                            name: 'Bob',
                            age: 25
                        }
                        
                        const person2  = {...person}
                        person2.name = 'Alice'
                        
                        console.log(person2.age) // Alice
                        console.log(person.age) // Bob
                    </code>
                </pre>
                <p class="main__p">
                    Тот же пример, person и person2, но при этом мы используем здесь уже другой синтаксис:
                </p>
                <pre>
                    <code>
                        const person2  = {...person} 
                    </code>
                </pre>
                <p class="main__p note">
                    ... - это оператор, 3 точки. Это оператор разделения объекта на свойства.
                </p>
                <p class="main__p">
                    В данном примере берется объект person и разделяется на свойства name и age<br>
                    И потом эти свойства сразу же собираются в новый объект, потому что мы указали фигурные
                    скобки. То есть мы разделили оригинальный объект на свойства и потом соединили эти свойства в новый
                    объект. Но при этом мы сформировали новый объект. person2 - это новая ссылка на новый объект,
                    который создался в памяти.
                </p>
                <p class="main__p">
                    Тем самым мы можем менять свойства нового объекта person2, вот таким образом:
                </p>
                <pre>
                    <code>
                        person2.name = 'Alice'
                    </code>
                </pre>
                <p class="main__p">
                    И в итоге свойство name нового созданного объекта person2 будет 'Alice' , а вот свойство
                    оригинального объекта person не изменится:
                </p>
                <pre>
                    <code>
                        console.log(person2.age) // Alice
                        console.log(person.age) // Bob
                    </code>
                </pre>
                <pre>
                    <code>
                        const person = {
                            name: 'Bob',
                            age: 25
                        }
                        
                        const person2  = {...person}
                        person2.name = 'Alice'
                        
                        console.log(person2.age) // Alice
                        console.log(person.age) // Bob
                    </code>
                </pre>
                <p class="main__p">
                    Но такой синтаксис также не полностью копирует объект. И здесь та жа проблема. Если у оригинального
                    объекта есть свойства, которые ссылаются на вложенные объекты, то ссылки сохранятся. И когда вы
                    будете пытаться в скопированном объекте менять такие вот вложенные объекты, они будут также меняться
                    и в оригинальном объекте. То есть вы сможете мутировать такие вложенные объекты.
                </p>
                <p class="main__p note">
                    Для данного примера такой вариант копирования объекта вполне подходит, так как здесь нет вложенных
                    объектов. И он короче предыдущего 1-ого варианта.
                </p>

                <a name="HOW_TO_AVOID_OBJECT_MUTATION.3"></a>
                <p class="main__subtitle-1">
                    Папка 03. Вариант №3
                </p>
                <p class="main__p note">
                    В этом варианте можно создать копию объекта и полностью избежать мутации.
                </p>
                <pre>
                    <code>
                        const person = {
                            name: 'Bob',
                            age: 25
                        }
                        
                        const person2  = JSON.parse(JSON.stringify(person))
                        person2.name = 'Alice'
                        
                        console.log(person2.name) // Alice
                        console.log(person.name) // Bob
                    </code>
                </pre>
                <p class="main__p">
                    В этом варианте вы видите уже знакомые вам методы:
                    <strong>parse</strong> и <strong>stringify</strong>
                    , а это методы объекта JSON, и что мы делаем? Сначала мы конвертируем объект person в строку (JSON -
                    это строка), и здесь мы получим строку после вызова метода <strong>stringify</strong>
                </p>
                <pre>
                    <code>
                        (JSON.stringify(person))
                    </code>
                </pre>
                <p class="main__p">
                    А потом мы берем эту строку и передаем как аргумент в вызове уже другого метода
                    <strong>parse</strong>
                </p>
                <pre>
                    <code>
                        JSON.parse(JSON.stringify(person))
                    </code>
                </pre>
                <p class="main__p">
                    По сути мы берем строку JSON и конвертируем обратно в объект JavaScript , используя метод
                    <strong>parse</strong> объекта JSON<br>
                    По сути происходит двойная конвертация - Объект в JSON , JSON в объект. И тем самым путем такой
                    двойной конвертации мы получим полностью новый объект, и в этом новом объекте мы можем менять любые
                    свойства. Также мы добиваемся того, что ссылки на вложенные объекты, если такие объекты в
                    оригинальном объекте есть, не сохраняются. То есть создается полностью новый объект со всеми новыми
                    ссылками, включая вложенные, если такие вложенные есть.
                </p>










            </div><!---------------main__wrapper--------------->
        </div><!--------------------main-------------------->






        <!----- ASIDE-2 ----->
        <div class="wrapper__aside-2">
            <div class="aside-2 general__area-1">
                <ul class="aside-2__index-search-list">
                    <li class="aside-2__index-search-item">
                        <a class="aside-2__index-search-link" href="#MUTATION_IN_JAVASCRIPT">Мутация в JavaScript</a>
                    </li>
                    <li class="aside-2__index-search-item">
                        <a class="aside-2__index-search-link" href="#HOW_TO_AVOID_OBJECT_MUTATION">Как избежать
                            мутации объектов
                        </a>
                        <ul>
                            <li><a class="aside-2__index-search-link" href="#HOW_TO_AVOID_OBJECT_MUTATION.1">Папка 1</a>
                            </li>
                            <li><a class="aside-2__index-search-link" href="#HOW_TO_AVOID_OBJECT_MUTATION.2">Папка 2</a>
                            </li>
                            <li><a class="aside-2__index-search-link" href="#HOW_TO_AVOID_OBJECT_MUTATION.3">Папка 3</a>
                            </li>
                        </ul>
                    </li>
                </ul><!--aside-2__index-search-list-->
            </div><!--aside_2-->
        </div>







        <!----- FOOTER ----->
        <a name="FOOTER"></a>
        <div class="footer general__area-1">Footer</div>
    </div><!--wrapper-->



</body>

</html>